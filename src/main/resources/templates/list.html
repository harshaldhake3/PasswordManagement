<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Your Credentials</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/app.css" rel="stylesheet">
</head>
<body class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="mb-0">Your stored credentials</h2>
        <div class="d-flex gap-2">
            <a class="btn btn-success" th:href="@{/credentials/add}">Add new</a>
            <a class="btn btn-outline-info" th:href="@{/credentials/export}">Export CSV</a>
            <a class="btn btn-outline-secondary" th:href="@{/audit}">Audit</a>
            <a class="btn btn-danger" th:href="@{/logout}">Logout</a>
        </div>
    </div>
    <div class="mb-3 d-flex gap-2">
        <input id="filterBox" class="form-control" placeholder="Filter by site, username, or tags">
        <button id="exportNotesBtn" class="btn btn-outline-primary">Export Local Notes</button>
        <label class="btn btn-outline-secondary mb-0">
            Import Local Notes <input id="importNotesInput" type="file" accept="application/json" hidden>
        </label>
    </div>
    <table class="table table-striped table-hover align-middle">
        <thead><tr>
            <th>★</th>
            <th>Site</th>
            <th>Username</th>
            <th>Tags</th>
            <th>Health</th>
            <th>Actions</th>
        </tr></thead>
        <tbody>
        <tr th:each="c : ${creds}" th:attr="data-id=${c.id}">
            <td>
                <form th:action="@{|/credentials/toggle-favorite/${c.id}|}" method="post" class="d-inline">
                    <button class="btn btn-sm" th:classappend="${c.favorite} ? 'btn-warning' : 'btn-outline-secondary'"
                            title="Toggle favorite">★</button>
                </form>
            </td>
            <td th:text="${c.site}"></td>
            <td th:text="${c.loginUsername}"></td>
            <td>
                <span class="badge text-bg-secondary me-1" th:each="t : ${#strings.arraySplit((c.tags == null ? '' : c.tags), ',')}" th:text="${#strings.trim(t)}"></span>
            </td>
            <td>
                <span class="badge" th:classappend="
                    ${strengths[c.id]}==0 ? 'text-bg-danger' :
                    (${strengths[c.id]}==1 ? 'text-bg-danger' :
                    (${strengths[c.id]}==2 ? 'text-bg-warning' :
                    (${strengths[c.id]}==3 ? 'text-bg-info' : 'text-bg-success')))">
                    <span th:text="${strengths[c.id]*25}">0</span>%
                </span>
                <span class="badge text-bg-danger" th:if="${reusedIds.contains(c.id)}">reused</span>
                <span class="badge text-bg-danger" th:if="${compromisedIds.contains(c.id)}">compromised</span>
                <span class="badge text-bg-warning" th:if="${staleIds.contains(c.id)}">stale</span>
            </td>
            <td>
                <a class="btn btn-sm btn-primary" th:href="@{|/credentials/view/${c.id}|}">View</a>
                <a class="btn btn-sm btn-warning" th:href="@{|/credentials/edit/${c.id}|}">Edit</a>
                <a class="btn btn-sm btn-danger" th:href="@{|/credentials/delete/${c.id}|}">Delete</a>
                <button type="button" class="btn btn-sm btn-outline-secondary notes-btn ms-1">Local Notes</button>
            </td>
        </tr>
        </tbody>
    </table>
    <script src="/js/app.js"></script>
    <div id="toast-container" class="toast-container"></div>
</body>
</html>